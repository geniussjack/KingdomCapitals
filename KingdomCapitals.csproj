<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">x64</Platform>
    <ProjectGuid>{1DBDFC32-2729-4CB1-8088-6E75B009C6A8}</ProjectGuid>
    <OutputType>Library</OutputType>
    <AppDesignerFolder>Properties</AppDesignerFolder>
    <RootNamespace>KingdomCapitals</RootNamespace>
    <AssemblyName>KingdomCapitals</AssemblyName>
    <TargetFrameworkVersion>v4.7.2</TargetFrameworkVersion>
    <FileAlignment>512</FileAlignment>
    <Deterministic>true</Deterministic>
    <LangVersion>9.0</LangVersion>
    <GameFolder>D:\SteamLibrary\steamapps\common\Mount &amp; Blade II Bannerlord</GameFolder>
    <ModulesFolder>$(GameFolder)\Modules</ModulesFolder>
    <!-- Assembly Metadata (moved from AssemblyInfo.cs) -->
    <AssemblyTitle>KingdomCapitals</AssemblyTitle>
    <Product>KingdomCapitals</Product>
    <Copyright>Copyright Â© 2025</Copyright>
    <Version>1.0.0.0</Version>
    <FileVersion>1.0.0.0</FileVersion>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)' == 'Debug|x64'">
    <DebugSymbols>true</DebugSymbols>
    <OutputPath>bin\Win64_Shipping_Client\</OutputPath>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <DebugType>full</DebugType>
    <PlatformTarget>x64</PlatformTarget>
    <ErrorReport>prompt</ErrorReport>
    <Prefer32Bit>false</Prefer32Bit>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)' == 'Release|x64'">
    <OutputPath>$(ModulesFolder)\KingdomCapitals\bin\Win64_Shipping_Client\</OutputPath>
    <DefineConstants>TRACE</DefineConstants>
    <Optimize>true</Optimize>
    <DebugType>pdbonly</DebugType>
    <PlatformTarget>x64</PlatformTarget>
    <ErrorReport>prompt</ErrorReport>
    <Prefer32Bit>false</Prefer32Bit>
  </PropertyGroup>
  <ItemGroup>
    <Reference Include="System" />
    <Reference Include="System.Core" />
    <Reference Include="System.Xml.Linq" />
    <Reference Include="System.Data.DataSetExtensions" />
    <Reference Include="Microsoft.CSharp" />
    <Reference Include="System.Data" />
    <Reference Include="System.Net.Http" />
    <Reference Include="System.Xml" />
    <!-- Harmony -->
    <Reference Include="0Harmony, Version=2.3.6.0, Culture=neutral, processorArchitecture=MSIL">
      <HintPath>$(ModulesFolder)\Bannerlord.Harmony\bin\Win64_Shipping_Client\0Harmony.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <!-- Bannerlord Core -->
    <Reference Include="TaleWorlds.Core">
      <HintPath>$(GameFolder)\bin\Win64_Shipping_Client\TaleWorlds.Core.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <Reference Include="TaleWorlds.Engine">
      <HintPath>$(GameFolder)\bin\Win64_Shipping_Client\TaleWorlds.Engine.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <Reference Include="TaleWorlds.Library">
      <HintPath>$(GameFolder)\bin\Win64_Shipping_Client\TaleWorlds.Library.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <Reference Include="TaleWorlds.Localization">
      <HintPath>$(GameFolder)\bin\Win64_Shipping_Client\TaleWorlds.Localization.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <Reference Include="TaleWorlds.MountAndBlade">
      <HintPath>$(GameFolder)\bin\Win64_Shipping_Client\TaleWorlds.MountAndBlade.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <Reference Include="TaleWorlds.ObjectSystem">
      <HintPath>$(GameFolder)\bin\Win64_Shipping_Client\TaleWorlds.ObjectSystem.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <!-- Bannerlord Campaign -->
    <Reference Include="TaleWorlds.CampaignSystem">
      <HintPath>$(GameFolder)\bin\Win64_Shipping_Client\TaleWorlds.CampaignSystem.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <Reference Include="TaleWorlds.CampaignSystem.ViewModelCollection">
      <HintPath>$(GameFolder)\bin\Win64_Shipping_Client\TaleWorlds.CampaignSystem.ViewModelCollection.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <Reference Include="SandBox">
      <HintPath>$(GameFolder)\Modules\SandBox\bin\Win64_Shipping_Client\SandBox.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <Reference Include="SandBox.View">
      <HintPath>$(GameFolder)\Modules\SandBox\bin\Win64_Shipping_Client\SandBox.View.dll</HintPath>
      <Private>False</Private>
    </Reference>
    <!-- MCM (Mod Configuration Menu) - Optional -->
    <Reference Include="MCMv5">
      <HintPath>$(GameFolder)\Modules\Bannerlord.MBOptionScreen\bin\Win64_Shipping_Client\MCMv5.dll</HintPath>
      <Private>False</Private>
    </Reference>
  </ItemGroup>
  <ItemGroup>
    <!-- Core -->
    <Compile Include="Core\SubModule.cs" />
    <Compile Include="Core\CapitalManager.cs" />
    <!-- Behaviors -->
    <Compile Include="Behaviors\CapitalManagementBehavior.cs" />
    <Compile Include="Behaviors\CapitalGarrisonBehavior.cs" />
    <Compile Include="Behaviors\CapitalConquestBehavior.cs" />
    <!-- Models -->
    <Compile Include="Models\ModSettings.cs" />
    <!-- Utils -->
    <Compile Include="Utils\CapitalData.cs" />
    <Compile Include="Utils\ModLogger.cs" />
    <!-- Patches -->
    <Compile Include="Patches\SettlementNameTooltipPatch.cs" />
    <Compile Include="Patches\CapitalOwnershipPatch.cs" />
  </ItemGroup>
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />

  <!-- Copy SubModule.xml and ModuleData to output -->
  <Target Name="CopyModuleFiles" AfterTargets="Build">
    <!-- Debug: Copy to project bin folder -->
    <PropertyGroup Condition="'$(Configuration)'=='Debug'">
      <ModuleOutputPath>bin\</ModuleOutputPath>
    </PropertyGroup>

    <!-- Release: Copy to game modules folder -->
    <PropertyGroup Condition="'$(Configuration)'=='Release'">
      <ModuleOutputPath>$(ModulesFolder)\KingdomCapitals\</ModuleOutputPath>
    </PropertyGroup>

    <!-- Copy SubModule.xml -->
    <Copy SourceFiles="SubModule.xml" DestinationFiles="$(ModuleOutputPath)SubModule.xml" SkipUnchangedFiles="true" />

    <!-- Copy entire ModuleData folder -->
    <ItemGroup>
      <ModuleDataFiles Include="ModuleData\**\*.*" />
    </ItemGroup>
    <Copy SourceFiles="@(ModuleDataFiles)" DestinationFiles="@(ModuleDataFiles->'$(ModuleOutputPath)ModuleData\%(RecursiveDir)%(Filename)%(Extension)')" SkipUnchangedFiles="true" />

    <Message Text="[$(Configuration)] Copied SubModule.xml and ModuleData to: $(ModuleOutputPath)" Importance="high" />
  </Target>

  <!-- Clean unnecessary files -->
  <Target Name="CleanOutputFiles" AfterTargets="Build">
    <!-- Always delete these files -->
    <ItemGroup>
      <FilesToDelete Include="$(OutputPath)*.deps.json" />
      <FilesToDelete Include="$(OutputPath)*.runtimeconfig.json" />
      <FilesToDelete Include="$(OutputPath)MCMv5.dll" />
      <FilesToDelete Include="$(OutputPath)0Harmony.dll" />
      <FilesToDelete Include="$(OutputPath)TaleWorlds.*.dll" />
      <FilesToDelete Include="$(OutputPath)SandBox*.dll" />
    </ItemGroup>
    <Delete Files="@(FilesToDelete)" />

    <!-- Delete .pdb only in Release -->
    <ItemGroup Condition="'$(Configuration)'=='Release'">
      <PdbFilesToDelete Include="$(OutputPath)*.pdb" />
    </ItemGroup>
    <Delete Files="@(PdbFilesToDelete)" Condition="'$(Configuration)'=='Release'" />

    <Message Text="Cleaned unnecessary files from output (game DLLs should come from game installation)" Importance="high" />
  </Target>
</Project>
